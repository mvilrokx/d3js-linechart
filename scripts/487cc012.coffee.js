!function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;i=d3.time.format("%d-%b-%Y").parse,a=750,b="cubic-in-out",j=function(){return $("#show-team-spread").is(":checked")},d=function(a){var b;return b=d3.format(" ,"),"$"+b(a/1e3)+"K"},e=function(a){return null==a&&(a=1),d3.format("."+a+"%")},f=function(a){var b;return b=function(){switch(!1){case!(a<=new Date("31-JAN-"+a.getFullYear())):return"";case!(a<=new Date("01-APR-"+a.getFullYear())):return"1st Quarter";case!(a<=new Date("01-JUL-"+a.getFullYear())):return"2nd Quarter";case!(a<=new Date("01-OCT-"+a.getFullYear())):return"3rd Quarter";case!(a<=new Date("31-DEC-"+a.getFullYear())):return"4th Quarter"}}()},h={top:120,right:20,bottom:30,left:60},c=window.innerWidth,l=Math.min(940,c)-h.left-h.right,g=Math.min(480,480*c/940)-h.top-h.bottom,n=d3.time.scale().range([0,l]),p=d3.scale.linear().range([g,0]),m=d3.svg.axis().scale(n).ticks(4).tickSize(-g,0,0).tickPadding(10).orient("bottom").tickFormat(function(a){return f(a)}),o=d3.svg.axis().ticks(4).tickSize(-l,0,0).scale(p).tickPadding(10).orient("left"),k=d3.select("#line-chart").append("svg").attr("width",l+h.left+h.right).attr("height",g+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")"),k.append("text").attr("x",0).attr("y",0-h.top/1.5).attr("class","chart-title").text("Your Sales Performance"),k.append("text").attr("x",0).attr("y",0-h.top/2.2).attr("class","chart-subtitle").text("Attainment vs Goal"),d3.json("data/data.json",function(c,f){var l,q,r,s,t,u,v,w,x,y,z,A,B,C;return f.forEach(function(a){return a.date=i(a.date)}),x=d3.nest().key(function(a){return a.name}).key(function(a){return a.type}).entries(f),l=function(a){return a.values.filter(function(a){return"actual"===a.key})},y=function(a){return a.values.filter(function(a){return"target"===a.key})},x.forEach(function(a){return y(a).forEach(function(b){return a.yearTarget=d3.max(b.values,function(a){return a.amount}),a.yearStart=d3.min(b.values,function(a){return a.date}),a.yearEnd=d3.max(b.values,function(a){return a.date}),b.values.forEach(function(b){return b.percentAttained=b.amount/a.yearTarget})}),l(a).forEach(function(b){return a.maxDate=d3.max(b.values,function(a){return a.date}),a.minAmount=d3.min(b.values,function(a){return a.amount}),a.maxAmount=d3.max(b.values,function(a){return a.amount}),b.values.forEach(function(b){return b.percentAttained=b.amount/a.yearTarget}),a.amountScale=[a.minAmount,d3.max([a.maxAmount,a.yearTarget])]})}),x.percentScale=[0,d3.max([1,d3.max(x,function(a){return d3.max(l(a),function(a){return d3.max(a.values,function(a){return a.percentAttained})})})])],u={},w={},x.forEach(function(a){return l(a).forEach(function(a){return a.values.forEach(function(a){return u[a.date]=d3.max([u[a.date],a.percentAttained]),w[a.date]=d3.min([w[a.date],a.percentAttained])})})}),v=d3.svg.line().x(function(a){return n(a.date)}).y(function(a){return j()?p(a.percentAttained):p(a.amount)}),q=d3.svg.area().x(v.x()).y0(function(a){return j()?p(a.percentAttainedLow):g}).y1(v.y()),d3.select("ul#members").selectAll(".person").data(x).enter().append("li").attr("class",function(a,b){return 0===b?"active":""}).on("click",function(a,b){return $(".active").removeClass("active"),$(this).addClass("active"),t(x[b])}).append("a").attr("href","#").attr("class","person ").attr("id",function(a,b){return"person-"+b}).html(function(a){return a.key}),$("#show-team-spread").on("change",function(){return $(".active").click()}),A=d3.select("#line-chart").append("div").attr("class","tooltip-popup").style("opacity",0),z=d3.select("#line-chart").append("div").attr("class","today-tooltip").style("top",h.top/2+"px").style("opacity",0).html("Today"),B=k.append("g").attr("class","x axis").attr("transform","translate(0,"+g+")"),C=k.append("g").attr("class","y axis"),s=function(){return a=500,b="cubic-in-out",this.duration(a).ease(b).delay(10)},r=function(a){var b,c,d,e,f,g,h;return k.selectAll(".person").data([a]).enter().append("g").attr("class","person"),f=k.select(".person"),h=f.selectAll(".team").data(function(){return j()?[{high:u,low:w}]:[]}),h.enter().insert("g",".actual").attr("class","team"),h.exit().remove(),h.selectAll(".teamarea").data(function(a){var b;return b=new Array,d3.entries(a).filter(function(a){return"high"===a.key}).map(function(a){return d3.entries(a.value).map(function(a){return b.push({date:new Date(a.key),percentAttained:a.value,percentAttainedLow:0})})}),d3.entries(a).filter(function(a){return"low"===a.key}).map(function(a){return d3.entries(a.value).map(function(a,c){return b[c].percentAttainedLow=a.value})}),[b]}).enter().append("path").attr("class","teamarea"),d=h.selectAll(".highest-performance").data(function(a){return[a.high]}).enter().append("g").attr("class","highest-performance"),d.selectAll(".highest-performance-line").data(function(a){return[a]}).enter().append("path").attr("class","highest-performance-line teamline"),d.selectAll("circle.dot").data(function(a){return d3.entries(a).map(function(a){return{date:new Date(a.key),percentAttained:a.value}})}).enter().append("circle").attr("class","dot dot-team"),e=h.selectAll(".lowest-performance").data(function(a){return[a.low]}).enter().append("g").attr("class","lowest-performance"),e.selectAll(".lowest-performance-line").data(function(a){return[a]}).enter().append("path").attr("class","lowest-performance-line teamline"),e.selectAll("circle.dot").data(function(a){return d3.entries(a).map(function(a){return{date:new Date(a.key),percentAttained:a.value}})}).enter().append("circle").attr("class","dot dot-team"),f.selectAll(".target, .actual").data(function(a){return a.values}).enter().append("g").attr("class",function(a){return a.key}),c=f.selectAll(".actual"),g=f.selectAll(".target"),c.selectAll(".actualline").data([!0]).enter().append("path").attr("class","actualline"),b=c.selectAll(".actualarea").data(function(){return j()?[]:[!0]}),b.enter().append("path").attr("class","actualarea"),b.exit().remove(),c.selectAll("circle.dot").data(function(a){return a.values}).enter().append("circle").attr("class","dot dot-hover dot-actual"),c.selectAll(".todayline").data([!0]).enter().append("path").attr("class","todayline"),g.selectAll(".targetline").data([!0]).enter().append("path").attr("class","targetline"),g.selectAll(".targetdisk").data(function(a){return a.values}).enter().append("g").attr("class","targetdisk"),g.selectAll(".targetdisk").selectAll(".target-outer").data([!0]).enter().append("circle").attr("class","target-outer"),g.selectAll(".targetdisk").selectAll(".target-center").data([!0]).enter().append("circle").attr("class","target-center")},t=function(a){var b,c,f,g,i,l,t;return r(a),f=k.selectAll(".person"),g=f.data()[0],b=f.selectAll(".actual"),l=f.selectAll(".target"),i=function(){return i=j()?x.percentScale:a.amountScale},t=function(){return t=j()?e(0):d},n.domain([a.yearStart,a.yearEnd]),p.domain(i()),B.transition().call(s).call(m.scale(n)),C.transition().call(s).call(o.scale(p).tickFormat(t())),f.selectAll("path.highest-performance-line").transition().call(s).attr("d",function(a){return j()?v(d3.entries(a).map(function(a){return{date:new Date(a.key),percentAttained:a.value}})):v({date:0,percentAttained:0,amount:0})}),f.select("g.highest-performance").selectAll("circle.dot").transition().call(s).attr("cx",v.x()).attr("cy",v.y()).attr("r",5),f.selectAll("path.lowest-performance-line").transition().call(s).attr("d",function(a){return j()?v(d3.entries(a).map(function(a){return{date:new Date(a.key),percentAttained:a.value}})):v({date:0,percentAttained:0,amount:0})}),f.select("g.lowest-performance").selectAll("circle.dot").transition().call(s).attr("cx",v.x()).attr("cy",v.y()).attr("r",5),f.select(".team").selectAll(".teamarea").transition().call(s).attr("d",function(a){return q(a)}),b.select("path.actualline").transition().call(s).attr("d",function(a){return v(a.values)}),b.select("path.actualarea").transition().call(s).attr("d",function(a){return q(a.values)}).style("opacity",function(){return j()?0:1}),l.select("path.targetline").transition().call(s).attr("d",function(a){var b,c;return c={date:d3.min(a.values,function(a){return a.date}),amount:d3.max(a.values,function(a){return a.amount}),percentAttained:d3.max(a.values,function(a){return a.amount/g.yearTarget})},b={date:d3.max(a.values,function(a){return a.date}),amount:d3.max(a.values,function(a){return a.amount}),percentAttained:d3.max(a.values,function(a){return a.amount/g.yearTarget})},v([c,b])}),c=b.selectAll("circle.dot").on("mouseover",function(b){var c;return c=j()?b.percentAttained:b.amount,A.transition().duration(250).style("opacity",.9),A.html('<span class="number">'+d(b.amount)+'</span> of <span class="number">'+d(a.yearTarget)+"</span></br>"+"attained"+'<hr class="divider">'+'<span class="number percentage-number">'+e()(b.amount/a.yearTarget)+"</span></br>"+" of goal met").style("left",n(b.date)-7+"px").style("top",p(c)+120+4+20+"px")}).on("mouseout",function(){return A.transition().duration(250).style("opacity",0)}),c.transition().call(s).attr("cx",v.x()).attr("cy",v.y()).attr("r",5),l.selectAll("g.targetdisk").each(function(){return d3.select(this).select(".target-outer").transition().call(s).attr("cx",v.x()).attr("r",12).attr("cy",v.y()),d3.select(this).select(".target-center").transition().call(s).attr("cx",v.x()).attr("r",5.5).attr("cy",v.y())}),b.select(".todayline").transition().call(s).attr("d",function(a){var b,c;return c={date:d3.max(a.values,function(a){return a.date}),amount:0,percentAttained:0},b={date:d3.max(a.values,function(a){return a.date}),amount:1.12*p.domain()[1],percentAttained:1.12*p.domain()[1]},v([c,b])}),z.datum(a).style("left",function(a){return n(a.maxDate)+h.left-20-2+"px"}).style("opacity",1)},t(x[0])})}.call(this);